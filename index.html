<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>æˆ‘çš„è®€ç¶“é€²åº¦è¡¨</title>
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+TC:wght@400;500;700&display=swap" rel="stylesheet">
    <style>
        :root { --primary-color: #2c3e50; --accent-color: #e67e22; --bg-color: #f4f7f6; }
        body { font-family: 'Noto Sans TC', sans-serif; background-color: var(--bg-color); margin: 0; padding: 0; color: #333; }
        
        /* é ‚éƒ¨ Header */
        header { background: #fff; padding: 20px; text-align: center; box-shadow: 0 2px 10px rgba(0,0,0,0.05); position: sticky; top: 0; z-index: 100; }
        h1 { margin: 0; font-size: 1.5em; color: var(--primary-color); }
        .today-display { font-size: 0.9em; color: #7f8c8d; margin-top: 5px; font-weight: 500; }

        .container { max-width: 600px; margin: 0 auto; padding: 20px; min-height: 100vh; }

        /* è®€å–ç‹€æ…‹èˆ‡éŒ¯èª¤è¨Šæ¯ */
        #status { text-align: center; padding: 20px; color: #666; font-size: 0.9em; }
        .error-msg { background: #ffebee; color: #c62828; padding: 15px; border-radius: 8px; text-align: left; line-height: 1.5; border: 1px solid #ef9a9a; }

        /* å¡ç‰‡è¨­è¨ˆ */
        .card { 
            background: white;
            border-radius: 12px;
            padding: 20px;
            margin-bottom: 15px;
            box-shadow: 0 4px 6px rgba(0,0,0,0.02);
            border-left: 5px solid #bdc3c7; /* é è¨­ç°è‰² */
            transition: all 0.3s ease;
        }

        /* ç¶“æ–‡å€å¡Šä½ˆå±€ */
        .reading-section { margin-top: 12px; }
        .reading-item { 
            display: flex; 
            justify-content: space-between; 
            align-items: center; 
            padding: 8px 0; 
            border-bottom: 1px solid #eee; 
        }
        .reading-item:last-child { border-bottom: none; }
        
        .label { 
            font-size: 0.8em; 
            color: #95a5a6; 
            text-transform: uppercase; 
            font-weight: bold; 
            width: 50px; /* å›ºå®šå¯¬åº¦è®“æ’ç‰ˆæ•´é½Š */
        }
        .content { 
            font-size: 1.1em; 
            font-weight: 500; 
            color: var(--primary-color); 
            flex-grow: 1; 
            text-align: right; 
        }

        /* ä»Šå¤©çš„ç‰¹æ®Šæ¨£å¼ */
        .card.today { 
            border-left-color: var(--accent-color); 
            background: #fff;
            transform: scale(1.02);
            box-shadow: 0 8px 20px rgba(230, 126, 34, 0.15);
            border: 2px solid var(--accent-color);
        }
        .card.today .date-row { color: var(--accent-color); font-weight: bold; }
        
        .date-row { font-size: 0.9em; color: #7f8c8d; display: flex; justify-content: space-between; margin-bottom: 10px; }
        .notes { background: #fff8e1; font-size: 0.85em; color: #8d6e63; padding: 8px 12px; border-radius: 6px; margin-top: 10px; }

        /* éå»æ—¥å­çš„æ¨£å¼ */
        .card.past { opacity: 0.6; }
        
        /* æ¨™ç±¤ Badge */
        .badge { background: var(--accent-color); color: white; padding: 2px 8px; border-radius: 10px; font-size: 0.75em; margin-left: 8px; }
    </style>
</head>
<body>

<header>
    <h1>ğŸ“– æ¯æ—¥è®€ç¶“</h1>
    <div class="today-display" id="header-date">Loading...</div>
</header>

<div class="container">
    <div id="status">æ­£åœ¨å¾ Google è©¦ç®—è¡¨è¼‰å…¥é€²åº¦...</div>
    <div id="content"></div>
</div>

<script src="https://cdnjs.cloudflare.com/ajax/libs/PapaParse/5.3.0/papaparse.min.js"></script>

<script>
    // âœ… ä½ çš„å°ˆå±¬é€£çµå·²ç¶“è¨­å®šå¥½äº†
    const sheetURL = 'https://docs.google.com/spreadsheets/d/e/2PACX-1vRZRE4__MO8iWk0-3mNMmfm9WshlYpZWuw9D5YgqNDayuR5w6qeBvIt7tOXuloiRe-8TYPxwBjGXMTk/pub?output=csv';

    // è¨­å®šä»Šå¤©çš„æ—¥æœŸ
    const today = new Date();
    document.getElementById('header-date').innerText = today.toLocaleDateString('zh-TW', { year: 'numeric', month: 'long', day: 'numeric', weekday: 'short' });

    // æº–å‚™å¤šç¨®æ—¥æœŸæ ¼å¼æ¯”å° (ç‚ºäº†æŠ“åˆ°ä½ çš„ 1/29, 2026/01/29 ç­‰å„ç¨®å¯èƒ½)
    const yyyy = today.getFullYear();
    const mm = String(today.getMonth() + 1).padStart(2, '0');
    const dd = String(today.getDate()).padStart(2, '0');
    const todayFormats = [
        `${yyyy}/${mm}/${dd}`,      // 2026/01/29
        `${yyyy}-${mm}-${dd}`,      // 2026-01-29
        `${today.getMonth() + 1}/${today.getDate()}`, // 1/29
        `${yyyy}/${today.getMonth() + 1}/${today.getDate()}` // 2026/1/29
    ];

    const contentDiv = document.getElementById('content');
    const statusDiv = document.getElementById('status');

    Papa.parse(sheetURL, {
        download: true,
        header: true,
        skipEmptyLines: true,
        complete: function(results) {
            if (results.data && results.data.length > 0) {
                statusDiv.style.display = 'none';
                renderCards(results.data);
            } else {
                statusDiv.innerHTML = '<div class="error-msg">è®€å–æˆåŠŸï¼Œä½†è©¦ç®—è¡¨æ˜¯ç©ºçš„ï¼Ÿè«‹ç¢ºèª Google Sheet æœ‰è³‡æ–™ã€‚</div>';
            }
        },
        error: function(err) {
            statusDiv.innerHTML = `<div class="error-msg">è®€å–å¤±æ•—<br>éŒ¯èª¤ä»£ç¢¼ï¼š${err}</div>`;
        }
    });

    function renderCards(data) {
        let foundToday = false;

        data.forEach(row => {
            // æŠ“å–ä½ çš„ç‰¹å®šæ¬„ä½ (Date, OT, Psalm/Proverbs, NT, Notes)
            // ä½¿ç”¨ trim() å»é™¤å¯èƒ½çš„ç©ºç™½
            const dateStr = row['Date'] ? row['Date'].trim() : '';
            const dayStr = row['Day'] || '';
            const ot = row['OT'] || '';
            const psalm = row['Psalm/Proverbs'] || '';
            const nt = row['NT'] || '';
            const notes = row['Notes'] || '';

            if (!dateStr) return; // å¦‚æœé€™è¡Œæ²’æœ‰æ—¥æœŸï¼Œè·³é

            // åˆ¤æ–·æ˜¯å¦ç‚ºä»Šå¤©
            const isToday = todayFormats.some(fmt => dateStr.includes(fmt));
            
            let cardClass = 'card';
            let badge = '';

            if (isToday) {
                cardClass += ' today';
                badge = '<span class="badge">ä»Šæ—¥é€²åº¦</span>';
                foundToday = true;
            } else if (!foundToday) {
                // å¦‚æœä»Šå¤©é‚„æ²’å‡ºç¾éï¼Œé‚£ä¹‹å‰çš„æ—¥å­å°±ç®—ã€Œéå»ã€(è®Šæ·¡)
                cardClass += ' past'; 
            }

            // çµ„åˆ HTML
            const cardHtml = `
                <div class="${cardClass}" id="${isToday ? 'today-card' : ''}">
                    <div class="date-row">
                        <span>${dateStr} (${dayStr})</span>
                        ${badge}
                    </div>
                    
                    <div class="reading-section">
                        ${ot ? `<div class="reading-item"><span class="label">èˆŠç´„</span><span class="content">${ot}</span></div>` : ''}
                        ${psalm ? `<div class="reading-item"><span class="label">è©©/ç®´</span><span class="content">${psalm}</span></div>` : ''}
                        ${nt ? `<div class="reading-item"><span class="label">æ–°ç´„</span><span class="content">${nt}</span></div>` : ''}
                    </div>

                    ${notes ? `<div class="notes">ğŸ“ ${notes}</div>` : ''}
                </div>
            `;
            
            contentDiv.insertAdjacentHTML('beforeend', cardHtml);
        });

        // å¦‚æœæ‰¾åˆ°äº†ä»Šå¤©ï¼Œè‡ªå‹•æ²å‹•åˆ°é‚£å¼µå¡ç‰‡
        const todayCard = document.getElementById('today-card');
        if (todayCard) {
            setTimeout(() => {
                todayCard.scrollIntoView({ behavior: 'smooth', block: 'center' });
            }, 500);
        } else {
            // å¦‚æœæ²’æ‰¾åˆ°ä»Šå¤©ï¼Œå¯èƒ½æ˜¯åœ¨æª¢æŸ¥ç‚ºä»€éº¼ï¼Œé€™è£¡å¯ä»¥é¡¯ç¤ºå€‹æç¤º(é¸æ“‡æ€§)
            console.log("æœªåœ¨åˆ—è¡¨ä¸­æ‰¾åˆ°ä»Šå¤©çš„æ—¥æœŸ");
        }
    }
</script>

</body>
</html>
