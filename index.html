<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>æˆ‘çš„è®€ç¶“æ‰‹å¸³</title>
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+TC:wght@400;500;700&display=swap" rel="stylesheet">
    <style>
        :root {
            --bg-color: #fdfbf7; /* ç±³ç™½è‰²èƒŒæ™¯ */
            --primary: #4a4a4a;
            
            /* === ğŸ¨ åœ¨é€™è£¡èª¿æ•´ä½ çš„é¡è‰² === */
            --color-ot: #795548;    /* èˆŠç´„ï¼šå’–å•¡è‰² */
            --color-psalm: #ffeaa7; /* è©©ç¯‡ï¼šæŸ”å’Œé»ƒ */
            --color-nt: #ffc3d0;    /* æ–°ç´„ï¼šæ·¡ç²‰è‰² */
            --color-note: #fff3cd;  /* ç­†è¨˜ï¼šæ·¡é»ƒä¾¿åˆ©è²¼ */
            --color-month: #795548; /* æœˆä»½æ¨™é¡Œï¼šè·ŸèˆŠç´„ä¸€æ¨£ç”¨å’–å•¡è‰²ï¼Œæ¯”è¼ƒçµ±ä¸€ */
        }

        body { font-family: 'Noto Sans TC', sans-serif; background-color: var(--bg-color); margin: 0; padding: 0; color: var(--primary); padding-bottom: 80px; }
        
        /* === é ‚éƒ¨å„€è¡¨æ¿ === */
        header { 
            background: rgba(255, 255, 255, 0.95); 
            backdrop-filter: blur(10px);
            padding: 15px 20px; 
            box-shadow: 0 4px 20px rgba(0,0,0,0.05); 
            position: sticky; 
            top: 0; 
            z-index: 1000; 
            text-align: center;
            border-bottom: 1px solid #f0e6dd;
        }
        
        .progress-circle {
            width: 100%; max-width: 500px; margin: 0 auto;
            display: flex; align-items: center; justify-content: space-between;
        }
        .progress-info { text-align: left; }
        .progress-title { font-size: 0.9em; color: #a1887f; margin-bottom: 2px; }
        .progress-percent { font-size: 1.8em; font-weight: 800; color: var(--color-ot); }
        
        /* æ¢ç‹€é€²åº¦æ¢ */
        .bar-bg { width: 100px; height: 8px; background: #efebe9; border-radius: 4px; overflow: hidden; }
        .bar-fill { height: 100%; background: var(--color-ot); width: 0%; transition: width 0.8s ease; }

        .container { max-width: 600px; margin: 0 auto; padding: 10px 20px; }

        /* === æœˆä»½åˆ†éš”ç·š === */
        .month-header {
            margin: 25px 0 15px 0;
            padding: 8px 18px;
            background: var(--color-month);
            color: white;
            font-weight: bold;
            font-size: 1.1em;
            border-radius: 20px;
            display: inline-block;
            box-shadow: 0 3px 8px rgba(121, 85, 72, 0.2);
        }

        /* === å¡ç‰‡è¨­è¨ˆ === */
        .card { 
            background: white;
            border-radius: 18px;
            padding: 18px;
            margin-bottom: 18px;
            box-shadow: 0 5px 15px rgba(0,0,0,0.02);
            border: 2px solid transparent; /* é ç•™é‚Šæ¡†ä½ç½® */
            position: relative;
            transition: transform 0.2s;
            cursor: pointer;
        }
        .card:active { transform: scale(0.98); }

        /* å®Œæˆç‹€æ…‹ - è®Šæˆæ·¡ç°è‰² */
        .card.completed { opacity: 0.6; background: #fcfcfc; border-color: #f1f1f1; }
        .card.completed .date-badge { background: #d7ccc8; } /* æ·ºå’–å•¡è‰² */
        .card.completed .check-icon { background: var(--color-ot); border-color: var(--color-ot); color: white; }

        /* ä»Šæ—¥ç‰¹åˆ¥æ¨£å¼ - æ”¹ç”¨å’–å•¡è‰²ç³»å¼·èª¿ */
        .card.today-highlight { 
            border: 3px solid #d7ccc8; 
            background: #fffdfc;
            box-shadow: 0 0 20px rgba(121, 85, 72, 0.15);
        }

        /* å¡ç‰‡å…§éƒ¨æ’ç‰ˆ */
        .card-header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 12px; }
        .date-badge { 
            background: #8d6e63; color: white; 
            padding: 4px 12px; border-radius: 12px; font-size: 0.85em; font-weight: bold; 
        }
        .check-icon {
            width: 24px; height: 24px; border: 2px solid #efebe9; border-radius: 50%;
            display: flex; align-items: center; justify-content: center;
            font-size: 14px; color: transparent; transition: all 0.2s;
        }

        /* ç¶“æ–‡å€å¡Š (ç¹½ç´›æ¨™ç±¤) */
        .scripture-row { display: flex; align-items: baseline; margin-bottom: 8px; }
        .tag { 
            font-size: 0.75em; padding: 3px 8px; border-radius: 8px; 
            margin-right: 10px; font-weight: bold; flex-shrink: 0;
            width: 40px; text-align: center;
            box-shadow: 0 2px 5px rgba(0,0,0,0.05);
        }
        
        /* === ğŸ¨ æ¨™ç±¤é¡è‰²è¨­å®š === */
        .tag.ot { background-color: var(--color-ot); color: white; } /* å’–å•¡è‰²åº•+ç™½å­— */
        
        .tag.psalm { 
            background-color: var(--color-psalm); 
            color: #7f6000; /* å› ç‚ºé»ƒè‰²å¤ªäº®ï¼Œå­—æ”¹ç”¨æ·±é‡‘è‰²æ‰çœ‹å¾—åˆ° */
        }
        
        .tag.nt { 
            background-color: var(--color-nt); 
            color: #c2185b; /* å› ç‚ºç²‰è‰²å¤ªæ·¡ï¼Œå­—æ”¹ç”¨æ·±ç²‰ç´…æ‰çœ‹å¾—åˆ° */
        }
        
        .scripture-text { font-size: 1.05em; font-weight: 500; color: #4e342e; }

        /* å¿ƒå¾—ç­†è¨˜å€ */
        .note-section {
            margin-top: 12px;
            background: var(--color-note);
            color: #795548;
            padding: 10px 12px;
            border-radius: 8px;
            font-size: 0.9em;
            line-height: 1.4;
            display: flex;
            align-items: flex-start;
        }
        .note-icon { margin-right: 6px; font-size: 1.1em; }

        #status { text-align: center; padding: 30px; color: #bcaaa4; }
    </style>
</head>
<body>

<header>
    <div class="progress-circle">
        <div class="progress-info">
            <div class="progress-title">è®€ç¶“é€²åº¦</div>
            <div class="progress-percent" id="percent-text">0%</div>
        </div>
        <div class="bar-bg">
            <div class="bar-fill" id="bar-fill"></div>
        </div>
    </div>
</header>

<div class="container">
    <div id="status">æ­£åœ¨è¼‰å…¥æ‚¨çš„è®€ç¶“æ‰‹å¸³...</div>
    <div id="content"></div>
</div>

<script src="https://cdnjs.cloudflare.com/ajax/libs/PapaParse/5.3.0/papaparse.min.js"></script>

<script>
    // â–¼â–¼â–¼â–¼â–¼â–¼â–¼â–¼â–¼â–¼â–¼â–¼â–¼â–¼â–¼â–¼â–¼â–¼â–¼â–¼â–¼â–¼â–¼â–¼â–¼â–¼â–¼â–¼â–¼â–¼â–¼â–¼â–¼â–¼â–¼â–¼â–¼â–¼â–¼â–¼â–¼â–¼â–¼â–¼
    // è«‹ç¢ºèªé€™è£¡æ˜¯ä½ æ­£ç¢ºçš„ CSV é€£çµ
    const sheetURL = 'https://docs.google.com/spreadsheets/d/e/2PACX-1vRZRE4__MO8iWk0-3mNMmfm9WshlYpZWuw9D5YgqNDayuR5w6qeBvIt7tOXuloiRe-8TYPxwBjGXMTk/pub?output=csv';
    // â–²â–²â–²â–²â–²â–²â–²â–²â–²â–²â–²â–²â–²â–²â–²â–²â–²â–²â–²â–²â–²â–²â–²â–²â–²â–²â–²â–²â–²â–²â–²â–²â–²â–²â–²â–²â–²â–²â–²â–²â–²â–²â–²â–²

    // è®€å–æœ¬åœ°ç´€éŒ„
    let savedChecks = JSON.parse(localStorage.getItem('bible_checks_v2')) || [];

    // è¨­å®šä»Šå¤©æ—¥æœŸ (æ”¯æ´æ ¼å¼: 2026/1/29 æˆ– 1/29)
    const now = new Date();
    // æŠ“å–ç°¡çŸ­æ ¼å¼åšæ¯”å°ï¼Œä¾‹å¦‚ "1/29"
    const todayShort = `${now.getMonth() + 1}/${now.getDate()}`; 
    const todayFull = `${now.getFullYear()}/${String(now.getMonth() + 1).padStart(2, '0')}/${String(now.getDate()).padStart(2, '0')}`;

    const contentDiv = document.getElementById('content');
    let totalCount = 0;

    Papa.parse(sheetURL, {
        download: true, header: true, skipEmptyLines: true,
        complete: function(results) {
            document.getElementById('status').style.display = 'none';
            if (results.data && results.data.length > 0) {
                totalCount = results.data.length;
                renderList(results.data);
                updateStats();
            }
        }
    });

    function renderList(data) {
        let lastMonth = '';
        let todayAnchorId = ''; // ç”¨ä¾†è¨˜éŒ„ä»Šå¤©è¦æ²å‹•åˆ°çš„ä½ç½®

        data.forEach((row, index) => {
            const dateStr = row['Date'] ? row['Date'].trim() : '';
            if (!dateStr) return;

            // 1. è™•ç†æœˆä»½åˆ†éš”ç·š
            let currentMonth = '';
            if (dateStr.includes('/')) {
                const parts = dateStr.split('/');
                if (parts.length === 3) currentMonth = parts[1]; // 2026/1/29
                else if (parts.length === 2) currentMonth = parts[0]; // 1/29
            }

            if (currentMonth && currentMonth !== lastMonth) {
                const monthTitle = document.createElement('div');
                monthTitle.className = 'month-header';
                monthTitle.innerText = `${currentMonth} æœˆ`;
                contentDiv.appendChild(monthTitle);
                lastMonth = currentMonth;
            }

            // 2. åˆ¤æ–·æ˜¯å¦ç‚ºä»Šå¤©
            const isToday = dateStr.includes(todayShort) || dateStr === todayFull;
            
            // 3. åˆ¤æ–·æ˜¯å¦å·²å®Œæˆ
            const isChecked = savedChecks.includes(dateStr);

            // 4. æº–å‚™å…§å®¹
            const ot = row['OT'] || '';
            const psalm = row['Psalm/Proverbs'] || '';
            const nt = row['NT'] || '';
            const notes = row['Notes'] || '';

            // å»ºç«‹å¡ç‰‡
            const card = document.createElement('div');
            card.className = `card ${isChecked ? 'completed' : ''}`;
            if (isToday) {
                card.classList.add('today-highlight');
                card.id = 'target-today'; 
                todayAnchorId = 'target-today';
            }

            card.onclick = () => toggleCheck(card, dateStr);

            card.innerHTML = `
                <div class="card-header">
                    <span class="date-badge">${dateStr}</span>
                    <div class="check-icon">âœ”</div>
                </div>
                
                ${ot ? `<div class="scripture-row"><span class="tag ot">èˆŠç´„</span><span class="scripture-text">${ot}</span></div>` : ''}
                ${psalm ? `<div class="scripture-row"><span class="tag psalm">è©©ç¯‡</span><span class="scripture-text">${psalm}</span></div>` : ''}
                ${nt ? `<div class="scripture-row"><span class="tag nt">æ–°ç´„</span><span class="scripture-text">${nt}</span></div>` : ''}
                
                ${notes ? `<div class="note-section"><span class="note-icon">ğŸ“</span>${notes}</div>` : ''}
            `;
            
            contentDiv.appendChild(card);
        });

        // 5. è‡ªå‹•æ²å‹•
        if (todayAnchorId) {
            setTimeout(() => {
                const element = document.getElementById(todayAnchorId);
                if (element) {
                    element.scrollIntoView({ behavior: 'smooth', block: 'center' });
                }
            }, 600);
        } else {
            setTimeout(() => {
                const firstUnchecked = document.querySelector('.card:not(.completed)');
                if (firstUnchecked) {
                    firstUnchecked.scrollIntoView({ behavior: 'smooth', block: 'center' });
                }
            }, 600);
        }
    }

    function toggleCheck(card, dateID) {
        if (savedChecks.includes(dateID)) {
            savedChecks = savedChecks.filter(id => id !== dateID);
            card.classList.remove('completed');
        } else {
            savedChecks.push(dateID);
            card.classList.add('completed');
        }
        localStorage.setItem('bible_checks_v2', JSON.stringify(savedChecks));
        updateStats();
    }

    function updateStats() {
        const checkedCount = savedChecks.length;
        const percent = totalCount > 0 ? Math.round((checkedCount / totalCount) * 100) : 0;
        
        document.getElementById('percent-text').innerText = percent + '%';
        document.getElementById('bar-fill').style.width = percent + '%';
    }
</script>

</body>
</html>
